AIが書いたテックブログ

# Apollo Client: アンマウント後に高速表示される理由

結論: **リロードしない限り、同じ Apollo Client のメモリキャッシュが残るので高速表示になります**。

## 何が起きているか

`useQuery` で取得したデータは **Apollo Client のメモリキャッシュ（InMemoryCache）** に保存されます。  
コンポーネントを **アンマウントしてもキャッシュは消えません**。  
そのため **再マウント時にキャッシュがあれば高速で描画**されます。

## いつキャッシュが効くのか

以下の条件がそろうと「キャッシュが効いている状態」になります。

- **同じ Apollo Client を使っている**
- **キャッシュにデータが残っている**
- **`fetchPolicy` がキャッシュを使う設定**

### fetchPolicy の代表例

- `cache-first`（デフォルト）: キャッシュがあればそれを返す  
- `cache-only`: キャッシュだけを見る  
- `network-only` / `no-cache`: 毎回ネットワーク  
- `cache-and-network`: まずキャッシュ、裏で再取得

## 「リロードすると速くならない」理由

ブラウザリロードは **JavaScript の実行環境が初期化される**ため、  
メモリキャッシュは **全部消えます**。  
結果として **初回と同じくネットワーク取得が発生**します。

## 今回の挙動は正しいか

アンマウント → 再マウントで **サーバー fetch せず高速表示**になるのは正しいです。  
ただし次のケースは例外です。

- 初回はキャッシュが空なのでネットワーク取得される  
- `fetchPolicy` を `network-only` などにすると毎回取得される  
- ブラウザをリロードするとキャッシュは消える

## まとめ

- Apollo のキャッシュは **コンポーネントの生存とは独立**している  
- **リロードしない限り**キャッシュは残る  
- **fetchPolicy とキャッシュの残り方**で挙動が決まる
